<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosmic Bharat - The Oracle AI</title>
    <style>
        /* üåå Cosmic Background */
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            background: radial-gradient(circle at center, #0a0a2a 0%, #000000 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            color: white;
        }

        /* ‚ú® The Glowing Cosmic Core */
        .cosmic-core {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: radial-gradient(circle, #00f3ff, #8a2be2);
            box-shadow: 0 0 40px #00f3ff, 0 0 80px #8a2be2, 0 0 120px inset #ffffff;
            animation: pulseCore 3s infinite alternate ease-in-out;
            margin-bottom: 30px;
            transition: all 0.5s ease;
        }

        @keyframes pulseCore {
            0% {
                transform: scale(0.95);
                box-shadow: 0 0 30px #00f3ff, 0 0 60px #8a2be2;
            }

            100% {
                transform: scale(1.05);
                box-shadow: 0 0 60px #00f3ff, 0 0 100px #8a2be2, 0 0 20px inset white;
            }
        }

        /* üéôÔ∏è Listening Mode */
        .listening-mode {
            animation: listenWave 0.5s infinite alternate ease-in-out !important;
            background: radial-gradient(circle, #ff0055, #ffaa00);
            box-shadow: 0 0 50px #ff0055, 0 0 100px #ffaa00;
        }

        @keyframes listenWave {
            0% {
                transform: scale(1);
                border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%;
            }

            100% {
                transform: scale(1.2);
                border-radius: 60% 40% 30% 70% / 60% 50% 40% 50%;
            }
        }

        /* üó£Ô∏è Speaking Mode (AI is replying) */
        .speaking-mode {
            animation: speakPulse 0.8s infinite alternate ease-in-out !important;
            background: radial-gradient(circle, #00ff88, #0088ff);
            box-shadow: 0 0 50px #00ff88, 0 0 100px #0088ff;
        }

        @keyframes speakPulse {
            0% {
                transform: scale(0.95);
            }

            100% {
                transform: scale(1.15);
            }
        }

        /* üìù Text Area */
        .oracle-text {
            font-size: 22px;
            font-weight: 300;
            text-align: center;
            letter-spacing: 1px;
            min-height: 80px;
            max-width: 800px;
            padding: 0 20px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            line-height: 1.5;
        }

        /* üîò Buttons */
        .action-buttons {
            display: flex;
            gap: 20px;
            margin-top: 30px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 1s ease;
        }

        .glass-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            color: white;
            padding: 12px 25px;
            font-size: 16px;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .glass-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: #00f3ff;
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.4);
            transform: translateY(-3px);
        }

        /* üõë Stop Button */
        .stop-btn {
            border-color: #ff0055;
            color: #ff0055;
            display: none;
            margin-top: 20px;
        }

        .stop-btn:hover {
            background: rgba(255, 0, 85, 0.15);
            box-shadow: 0 0 20px rgba(255, 0, 85, 0.4);
        }

        /* ‚å®Ô∏è NEW: Glass Search Input */
        .search-container {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
        }

        .glass-input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            color: white;
            padding: 15px 25px;
            font-size: 18px;
            border-radius: 30px;
            width: 300px;
            outline: none;
            transition: all 0.3s ease;
            text-align: center;
        }

        .glass-input:focus {
            border-color: #00f3ff;
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.3);
            width: 350px;
        }

        .glass-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }
    </style>
</head>

<body>

    <div class="cosmic-core" id="core"></div>
    <div class="oracle-text" id="typewriter"></div>

    <div class="action-buttons" id="btn-container">
        <button class="glass-btn" onclick="startTextMode()">‚å®Ô∏è Type Your Query</button>
        <button class="glass-btn" onclick="startVoiceMode()">üéôÔ∏è Speak to the Cosmos</button>
    </div>

    <div class="search-container" id="search-container">
        <input type="text" id="user-input" class="glass-input" placeholder="E.g., Aryabhata, Surgery..."
            autocomplete="off">
        <button class="glass-btn" onclick="submitTextQuery()">‚ú® Seek Wisdom</button>
    </div>

    <button class="glass-btn stop-btn" id="stop-btn" onclick="stopEverything()">üõë Stop Connection</button>

    <script>

        // üîë ‡§Ö‡§™‡§®‡•Ä API Key ‡§Ø‡§π‡§æ‡§Å ‡§∞‡§ñ‡•á‡§Ç
        const GEMINI_API_KEY = 'AIzaSyAgvoHz_2LB0yhkZcGVQclV9dy_BE2mr48';

        const typeWriterElement = document.getElementById('typewriter');
        const btnContainer = document.getElementById('btn-container');
        const searchContainer = document.getElementById('search-container');
        const userInput = document.getElementById('user-input');
        const core = document.getElementById('core');
        const stopBtn = document.getElementById('stop-btn');

        let isAIActive = false;

        // ‚è≥ NEW: Live Countdown Variables
        let cooldownTime = 0;
        let cooldownInterval = null;

        // üìù Initial Greeting
        const textToType = "How do you wish to converse?";
        let index = 0;
        function typeIntro() {
            if (index < textToType.length) {
                typeWriterElement.innerHTML += textToType.charAt(index);
                index++;
                setTimeout(typeIntro, 50);
            } else {
                setTimeout(() => {
                    btnContainer.style.opacity = "1";
                    btnContainer.style.transform = "translateY(0)";
                }, 500);
            }
        }
        window.onload = () => setTimeout(typeIntro, 1000);

        // ‚è≥ NEW: The Live Cooldown function
        function showCooldownWarning() {
            typeWriterElement.innerHTML = `<span style='color: #ffaa00;'>Cosmic energies are recharging. Please wait ${cooldownTime} seconds... ‚è≥</span>`;
        }

        function startCooldownTimer() {
            cooldownTime = 4; // 4 ‡§∏‡•á‡§ï‡§Ç‡§° ‡§ï‡§æ ‡§ü‡§æ‡§á‡§Æ‡§∞
            clearInterval(cooldownInterval);

            cooldownInterval = setInterval(() => {
                cooldownTime--;

                // ‡§Ö‡§ó‡§∞ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§™‡§∞ ‡§µ‡§æ‡§∞‡•ç‡§®‡§ø‡§Ç‡§ó ‡§¶‡§ø‡§ñ ‡§∞‡§π‡•Ä ‡§π‡•à, ‡§§‡•ã ‡§®‡§Ç‡§¨‡§∞ ‡§ï‡•ã ‡§≤‡§æ‡§á‡§µ ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•ã
                if (typeWriterElement.innerHTML.includes("recharging")) {
                    showCooldownWarning();
                }

                // ‡§ú‡§¨ ‡§ü‡§æ‡§á‡§Æ‡§∞ 0 ‡§π‡•ã ‡§ú‡§æ‡§è
                if (cooldownTime <= 0) {
                    clearInterval(cooldownInterval);
                    if (typeWriterElement.innerHTML.includes("recharging")) {
                        typeWriterElement.innerHTML = "<span style='color: #00ff88;'>Cosmic link restored.</span> How do you wish to converse?";
                    }
                }
            }, 1000); // ‡§π‡§∞ 1 ‡§∏‡•á‡§ï‡§Ç‡§° ‡§Æ‡•á‡§Ç ‡§ü‡§ø‡§ï ‡§ï‡§∞‡•á‡§ó‡§æ
        }

        // üåü Voice API Setup
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition;

        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.lang = 'en-IN';

            window.startVoiceMode = function () {
                // üõë ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡§§‡•á ‡§π‡•Ä ‡§™‡§π‡§≤‡•á ‡§ö‡•á‡§ï ‡§ï‡§∞‡•ã ‡§ï‡§ø ‡§ü‡§æ‡§á‡§Æ‡§∞ ‡§ö‡§≤ ‡§∞‡§π‡§æ ‡§π‡•à ‡§Ø‡§æ ‡§®‡§π‡•Ä‡§Ç
                if (cooldownTime > 0) {
                    showCooldownWarning();
                    return; // ‡§Æ‡§æ‡§á‡§ï ‡§ï‡•ã ‡§ë‡§® ‡§Æ‡§§ ‡§π‡•ã‡§®‡•á ‡§¶‡•ã
                }

                isAIActive = true;
                core.className = 'cosmic-core listening-mode';
                typeWriterElement.innerHTML = "Listening to the Cosmos... (Speak now) üéôÔ∏è";

                btnContainer.style.display = "none";
                searchContainer.style.display = "none";
                stopBtn.style.display = "flex";

                try { recognition.start(); } catch (e) { }

                recognition.onresult = function (event) {
                    const userSpeech = event.results[0][0].transcript;
                    handleUserQuery(userSpeech);
                };

                recognition.onerror = function (event) {
                    if (event.error !== 'aborted') stopEverything("Connection lost. Try again.");
                };
            };
        } else {
            console.warn("Speech API not supported in this browser.");
        }

        // ‚å®Ô∏è Text Mode Logic
        window.startTextMode = function () {
            // üõë ‡§Ø‡§π‡§æ‡§Å ‡§≠‡•Ä ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡§§‡•á ‡§π‡•Ä ‡§™‡§π‡§≤‡•á ‡§ö‡•á‡§ï ‡§ï‡§∞‡•ã
            if (cooldownTime > 0) {
                showCooldownWarning();
                return;
            }

            btnContainer.style.display = "none";
            searchContainer.style.display = "flex";
            typeWriterElement.innerHTML = "Channel your thoughts into words...";
            userInput.focus();
        };

        window.submitTextQuery = function () {
            const query = userInput.value.trim();
            if (query !== "") {
                searchContainer.style.display = "none";
                handleUserQuery(query);
            }
        };

        userInput.addEventListener("keypress", function (event) {
            if (event.key === "Enter") {
                event.preventDefault();
                submitTextQuery();
            }
        });

        // üß† Core Logic to Handle Query
        async function handleUserQuery(query) {
            isAIActive = true;
            stopBtn.style.display = "flex";
            core.className = 'cosmic-core';
            typeWriterElement.innerHTML = "You asked: <br> <span style='color: #00f3ff;'>\"" + query + "\"</span><br><br><span style='font-size:16px; color:#8a2be2;'>Consulting the Cosmic Archives... ‚ú®</span>";

            // ‚è≥ ‡§∞‡§ø‡§ï‡•ç‡§µ‡•á‡§∏‡•ç‡§ü ‡§≠‡•á‡§ú‡§®‡•á ‡§∏‡•á ‡§†‡•Ä‡§ï ‡§™‡§π‡§≤‡•á ‡§ü‡§æ‡§á‡§Æ‡§∞ ‡§ö‡§æ‡§≤‡•Ç ‡§ï‡§∞ ‡§¶‡•ã
            startCooldownTimer();

            const aiResponse = await fetchGeminiResponse(query);
            simulateAIReply(aiResponse);
        }

        // üöÄ REAL AI MAGIC: Auto-Detecting API & Calling Google Gemini
        async function fetchGeminiResponse(userQuery) {
            try {
                const listUrl = `https://generativelanguage.googleapis.com/v1beta/models?key=${GEMINI_API_KEY}`;
                const listRes = await fetch(listUrl);
                const listData = await listRes.json();

                if (!listRes.ok) {
                    return `Cosmic Error (API Key Issue): ${listData.error.message}`;
                }

                const workingModel = listData.models.find(m =>
                    m.supportedGenerationMethods.includes("generateContent") &&
                    m.name.includes("gemini")
                );

                if (!workingModel) {
                    return "Cosmic Error: No active AI models found for this API key.";
                }

                const modelName = workingModel.name;
                console.log("‚úÖ Auto-selected Model:", modelName);

                const url = `https://generativelanguage.googleapis.com/v1beta/${modelName}:generateContent?key=${GEMINI_API_KEY}`;

                const systemPrompt = `You are the 'Cosmic Oracle', an AI holding the pure wisdom of ancient Bharat. Answer the user's query in 2 to 3 simple, easy-to-understand sentences. 

Strict Rules:
1. Stay exactly on topic. Do not mix subjects. If the query is about Gods or philosophy, answer with spiritual/cultural wisdom. If it is about math or science, answer with ancient Indian scientific facts. 
2. Start your response with exactly ONE emoji that best matches the topic (e.g.,  for spirituality,  for astronomy,  for Ayurveda, for temples/culture,  for math). 
3. Do NOT use markdown symbols like * or # in your response. 

Query: "${userQuery}"`;

                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: systemPrompt }] }]
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    console.error("Google API Real Error:", data);
                    return `Cosmic Error: ${data.error.message}`;
                }

                let answer = data.candidates[0].content.parts[0].text;
                return answer.replace(/\*/g, '');

            } catch (error) {
                console.error("Fetch Request Failed:", error);
                return "The cosmic energies are disturbed. I cannot connect to the ancient archives right now.";
            }
        }

        // ü§ñ Text-to-Speech Output
        function simulateAIReply(responseText) {
            if (!isAIActive) return;

            core.className = 'cosmic-core speaking-mode';
            typeWriterElement.innerHTML = "";

            const utterance = new SpeechSynthesisUtterance(responseText);
            utterance.lang = 'en-IN';
            utterance.rate = 0.95;
            utterance.pitch = 0.9;

            utterance.onend = function () {
                if (isAIActive) stopEverything(responseText + "<br><br><span style='font-size:14px; color:#00ff88;'>[Transmission Complete]</span>");
            };

            window.speechSynthesis.speak(utterance);

            let i = 0;
            function typeResponse() {
                if (i < responseText.length && isAIActive) {
                    typeWriterElement.innerHTML += responseText.charAt(i);
                    i++;
                    setTimeout(typeResponse, 40);
                }
            }
            typeResponse();
        }

        // üõë Stop Everything
        window.stopEverything = function (customMessage = "Cosmic link paused. What next?") {
            isAIActive = false;
            if (recognition) recognition.stop();
            window.speechSynthesis.cancel();

            core.className = 'cosmic-core';
            typeWriterElement.innerHTML = customMessage;

            stopBtn.style.display = "none";
            searchContainer.style.display = "none";
            userInput.value = "";
            btnContainer.style.display = "flex";
            setTimeout(() => { btnContainer.style.opacity = "1"; }, 100);
        }
    </script>

</body>

</html>